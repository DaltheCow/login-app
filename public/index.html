<html ng-app="bidApp">
    <head>
        <meta charset="utf-8">
        <title>Bid App</title>
        <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
    </head>
    <script>
        var bidApp = angular.module('bidApp', [])
        bidApp.controller('login', ['$scope', '$http', function ($scope, $http) {
            $scope.loginName = ""
            $scope.loginPassword = ""
            $scope.regName = ""
            $scope.regPassword = ""
            $scope.msg = ""

            $scope.login = function() {
                if ($scope.loginName && $scope.loginPassword) {
                    $http({
                        method: 'POST',
                        url: '/login',
                        data: {name: $scope.loginName,
                               password: $scope.loginPassword}
                    }).then(function success(res) {
                        const data = res.data
                        if (data.token) {
                            $scope.msg = "logged in"
                            localStorage.setItem("token", data.token)
                        } else {
                            console.log("No token received")
                        }
                    }), function err(res) {
                        console.log(res)
                    }
                }
            }

            $scope.register = function() {
                if ($scope.regName && $scope.regPassword) {
                    $http({
                        method: 'POST',
                        url: '/register',
                        data: {name: $scope.regName,
                               password: $scope.regPassword}
                    }).then(function success(res) {
                        console.log(res)
                    }), function err(res) {
                        console.log(res)
                    }
                }
            }

            $scope.getSecret = function() {
                $http({
                    method: 'GET',
                    url: '/secret',
                    data: null,
                    headers: {'Authorization': 'JWT ' + localStorage.getItem("token")}
                }).then(function success(res) {
                    console.log(res.data)
                }), function err(res) {
                    console.log(res)
                }
            }
        }])
    </script>
    <body ng-controller="login">
    <label>Register</label>
    <form ng-submit="register()">
      <input type="text" ng-model="regName" placeholder="username">
      <input type="text" ng-model="regPassword" placeholder="password">
      <input type="submit" value="register">
    </form>
    <label>Login</label>
    <form ng-submit="login()">
      <input type="text" ng-model="loginName" placeholder="username">
      <input type="text" ng-model="loginPassword" placeholder="password">
      <input type="submit" value="login">
    </form>
    <button ng-click="getSecret()">Get Secret</button>
    <div>{{message}}</div>
    </body>